{% extends 'demo.html' %}
{% load static %}
{% block search %}
    <div style="float: right;width: 400px">
        <form method="get">
            <div class="input-group">
                <input id='search' name='search' type="search" class="form-control" placeholder="关键字">
                <span class="input-group-btn">
                    <button type="submit" onclick="btn1()" class="btn btn-default">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                    </button>
                </span>
            </div>
        </form>
    </div>
{% endblock %}
{% block content %}

    <div class="panel panel-default">
        <div class="panel-heading">折线图</div>
        <div class="panel-body">
            <div id="m1" style="width: 100%;height: 400px;"></div>
        </div>
    </div>

{% endblock %}
{% block js %}
    <script src="{% static 'js/echarts.js' %}"></script>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例

        myChart = echarts.init(document.getElementById('m1'));
        option = {
            title: {
                text: 'ECharts 入门示例'
            },
            tooltip: {},
            legend: {
                data: []
            },
            xAxis: {
                type: "category",
                axisLabel: {
                    //x轴文字的配置
                    show: true,
                    interval: 0,//使x轴文字显示全
                    textStyle: {
                        color: 'blank'
                    },
                    formatter: function (params) {
                        var newParamsName = "";
                        var paramsNameNumber = params.length;
                        var provideNumber = 9; //一行显示几个字
                        var rowNumber = Math.ceil(paramsNameNumber / provideNumber);
                        if (paramsNameNumber > provideNumber) {
                            for (var p = 0; p < rowNumber; p++) {
                                var tempStr = "";
                                var start = p * provideNumber;
                                var end = start + provideNumber;
                                if (p == rowNumber - 1) {
                                    tempStr = params.substring(start, paramsNameNumber);
                                } else {
                                    tempStr = params.substring(start, end) + "\n";
                                }
                                newParamsName += tempStr;
                            }
                        } else {
                            newParamsName = params;
                        }
                        return newParamsName;
                    }
                },
                data: []
            },
            yAxis: {},
            series: [],

        };

        function btn1() {
            $.ajax({
                url: '/data/list/',
                type: 'get',
                data: {search: document.getElementById('search').value},
                dataType: 'JSON',
                success: function (res) {
                    // 指定图表的配置项和数据
                    option.legend.data = res.data.legend
                    option.xAxis.data = res.data.xAxis
                    option.series = res.data.series_list
                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
                }
            })
        }
        $.ajax({
                url: '/data/chart/',
                type: 'get',
                dataType: 'JSON',
                success: function (res) {
                    // 指定图表的配置项和数据
                    option.legend.data = res.data.legend
                    option.xAxis.data = res.data.xAxis
                    option.series = res.data.series_list
                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
                }
            })
    </script>
{% endblock %}